# P1.1 UX Problem Map + Target UI Structure (Reservations + Seating/Allocation)

> Scope: UI-only analysis based on current components. No backend/schema changes proposed.

## Mental Model Separation Checklist (Capacity vs Allocation vs Seating)

### Current conceptual layers
- **Capacity**: limits + ledger + per-slot counts (`reservation_capacity`, `dailyCapacity`, `bookableWindow`).
- **Allocation**: decision chain (`allocationIntent → allocationOverride → allocationFinal → allocated`).
- **Seating**: concrete table assignment (`zoneId`, `assignedTableIds`, floorplan view).

### Where UI currently mixes them
- **FoglalasokApp booking details** mixes allocation diagnostics, overrides, seating assignment, and floorplan in one dense section.
- **SeatingSettingsModal** mixes allocation settings with zones/tables/combinations/floorplans in a single modal.
- **ReservationSettingsForm** mixes capacity, booking windows, guest form, and theme in one screen.

### Separation goal (visual only)
- **Capacity** in its own panel/tab with clear “limits + counts” language.
- **Allocation** in a “Decision Chain” block (intent/override/final/allocated).
- **Seating** in its own “Table assignment + floorplan” block.

```
[Capacity]
  limits + ledger + per-slot counts
        ↓ (affects)
[Allocation Decision Chain]
  intent → override → final → allocated
        ↓ (drives)
[Seating Assignment]
  zoneId + assignedTableIds + floorplan
```

```
Booking Detail View (target grouping)
- At-a-glance summary
- Capacity panel
- Allocation decision chain (collapsed diagnostics)
- Seating panel (tables + floorplan)
```

```
Decision Chain (diagnostics collapsed by default)
Intent → Override → Final → Allocated
           + [Diagnostics ▼] (traceId, reason codes)
```

---

# UX Problem Map + Target Structure (by screen)

## 1) Public Booking (ReservationPage)

### Primary job-to-be-done
- Guest books a reservation with preferred time, party size, and contact info.

### Critical actions (top 3)
1. Pick date/time.
2. Enter party size + contact info.
3. Submit reservation.

### Cognitive load drivers
- Multi-step form with multiple required fields and conditional options.
- Booking window constraints are implicit; errors appear after submit.

### Information architecture issues
- Capacity and availability signals are not clearly separated from booking inputs.

### Confusing naming / raw data display
- Technical validation messages may surface (from normalized errors).

### Error states & “what should user do next?”
- Errors appear but may not highlight which field needs correction.

### Quick wins (UI-only)
- Add inline field-level hints for time window and capacity constraints.
- Show a short “what happens next” confirmation in success state.

### Deeper changes (UI-only, larger)
- Progressive disclosure for optional fields (custom selects).
- Dedicated “availability” panel separate from input fields.

#### Impact/Effort
| Issue | Impact | Effort |
|---|---|---|
| Field-level time window hints | M | S |
| Clear availability panel | M | M |
| Progressive disclosure for optional fields | M | M |

### Target UI structure (P1.1)
- **Top:** Brand + unit summary.
- **Section 1:** Date/time selection (with visible booking window).
- **Section 2:** Party size + seating preference.
- **Section 3:** Contact details.
- **Section 4 (collapsed by default):** Optional fields (custom selects).
- **Footer:** Submit CTA with inline error summary.

---

## 2) Public Manage (ManageReservationPage)

### Primary job-to-be-done
- Guest modifies or cancels a reservation; admin can approve/reject via token.

### Critical actions (top 3)
1. Confirm reservation details.
2. Cancel reservation.
3. Modify time/headcount.

### Cognitive load drivers
- Multiple action types (guest cancel/modify + admin approve/reject) in one UI.
- Admin auto-action when tokens present can surprise users.

### Information architecture issues
- Guest and admin actions are visually co-located.

### Confusing naming / raw data display
- Token/trace info appears in logs but not explained to users.

### Error states & “what should user do next?”
- Errors are normalized but lack explicit next-step guidance.

### Quick wins (UI-only)
- Separate “Guest Actions” vs “Admin Actions” sections.
- Add explicit “What happens next” hints after cancel/modify.

### Deeper changes (UI-only, larger)
- Two-step confirm for admin actions even if auto-triggered.
- Add status badges near key actions to reduce confusion.

#### Impact/Effort
| Issue | Impact | Effort |
|---|---|---|
| Separate guest/admin sections | H | S |
| Post-action guidance | M | S |
| Admin confirm step | M | M |

### Target UI structure (P1.1)
- **Top:** Reservation summary (status, date/time, party size).
- **Section A:** Guest actions (Modify, Cancel) with inline status feedback.
- **Section B (collapsed by default):** Admin actions (Approve/Reject).
- **Diagnostics (collapsed):** Trace info + technical details.

---

## 3) Admin Bookings (FoglalasokApp)

### Primary job-to-be-done
- Admin reviews daily bookings, updates seating, and manages allocation overrides.

### Critical actions (top 3)
1. Review bookings by date.
2. Assign seating (zone/tables).
3. Set allocation overrides or resolve conflicts.

### Cognitive load drivers
- Dense booking detail panel with multiple allocation fields and raw data.
- Multiple management tools (logs, seating, overrides, floorplan) in one area.

### Information architecture issues
- Allocation, seating, capacity, and logs appear intermixed.

### Confusing naming / raw data display
- Raw IDs or internal strings displayed (allocation summary strings, reasons).

### Error states & “what should user do next?”
- Inline errors shown but no unified resolution path for conflicts.

### Quick wins (UI-only)
- Add “At-a-glance” booking summary block.
- Group allocation data into a decision chain block.
- Collapse diagnostic fields by default.

### Deeper changes (UI-only, larger)
- Split booking details into tabs: Summary, Seating, Allocation, Logs.
- Add conflict resolution panel with explicit next steps.

#### Impact/Effort
| Issue | Impact | Effort |
|---|---|---|
| Summary + decision chain block | H | M |
| Diagnostics collapsed by default | M | S |
| Tabs for details | H | M |

### Target UI structure (P1.1)
- **Top:** Date + filters + key KPIs (counts).
- **Booking card/list:** “At a glance” summary (status, name, party size, time).
- **Booking details modal:**
  1) Summary block
  2) Capacity panel (daily limit + counts)
  3) Decision Chain block (intent → override → final → allocated)
  4) Seating panel (tables + floorplan)
  5) Logs panel (collapsed)
- **Diagnostics:** traceId/reason codes only inside expandable “Diagnostics”.

---

## 4) Seating Settings Modal (SeatingSettingsModal)

### Primary job-to-be-done
- Admin configures seating and allocation rules for a unit.

### Critical actions (top 3)
1. Enable allocation and set strategy.
2. Manage zones/tables.
3. Manage combinations/floorplans.

### Cognitive load drivers
- One large modal with multiple admin workflows and complex state.

### Information architecture issues
- Allocation config mixed with geometry/editing tasks.

### Confusing naming / raw data display
- Technical fields shown with minimal description (e.g., strategies, modes).

### Error states & “what should user do next?”
- Errors appear inline without guided remediation.

### Quick wins (UI-only)
- Split into tabs and label “Advanced” settings.
- Add short helper text for strategy/mode fields.

### Deeper changes (UI-only, larger)
- Dedicated overview panel with basic allocation toggles.
- Move floorplan editing to its own tab with clear context.

#### Impact/Effort
| Issue | Impact | Effort |
|---|---|---|
| Split into tabs | H | M |
| Helper text for strategies | M | S |
| Separate floorplan tab | H | M |

### Target UI structure (P1.1)
- **Tabs:** Overview, Zones, Tables, Combinations, Floorplans.
- **Default:** Overview tab open; others collapsed by selection.
- **Advanced section:** Overflow/emergency zones, cross-zone combos, debug tools.

---

## 5) Floorplan Viewer (FloorplanViewer)

### Primary job-to-be-done
- Admin views and optionally selects tables/zones on a floorplan.

### Critical actions (top 3)
1. See floorplan with table status.
2. Select zone/table (if enabled by parent).
3. Understand highlighting for selection/override.

### Cognitive load drivers
- No guidance when no floorplan is active.

### Information architecture issues
- Floorplan viewer lacks clear link to seating assignments or allocation override context.

### Confusing naming / raw data display
- None significant; mostly visual.

### Error states & “what should user do next?”
- “No active floorplan” message without next action.

### Quick wins (UI-only)
- Add small hint: “Set active floorplan in Seating Settings.”

### Deeper changes (UI-only, larger)
- Legend with table capacity hints and statuses.

#### Impact/Effort
| Issue | Impact | Effort |
|---|---|---|
| Add next-step hint | M | S |
| Enhanced legend | M | M |

### Target UI structure (P1.1)
- Legend + status chips at top.
- Floorplan canvas center.
- Action hints below (if selection enabled).

---

## 6) Reservation Settings (ReservationSettingsModal/Form)

### Primary job-to-be-done
- Admin configures booking rules, guest form fields, and theme.

### Critical actions (top 3)
1. Set booking window and capacity.
2. Configure guest form fields.
3. Save settings.

### Cognitive load drivers
- Many settings in a large form; capacity override mixed into general settings.

### Information architecture issues
- Capacity overrides and theme settings appear alongside core booking settings.

### Confusing naming / raw data display
- Some labels are technical (e.g., “daily capacity override”).

### Error states & “what should user do next?”
- Errors appear as alerts; no inline remediation path.

### Quick wins (UI-only)
- Add “Capacity” subpanel within General tab.
- Inline helper text for booking windows and capacity.

### Deeper changes (UI-only, larger)
- Separate “Theme” tab from “Booking Rules” with summaries.

#### Impact/Effort
| Issue | Impact | Effort |
|---|---|---|
| Capacity subpanel | M | S |
| Helper text | M | S |
| Separate theme summary | M | M |

### Target UI structure (P1.1)
- **Tabs:** Booking Rules, Guest Form, Theme.
- **Booking Rules:** booking window + capacity grouped in one panel.
- **Guest Form:** custom fields list with inline previews.

---

# SeatingSettingsModal Decomposition Plan (UI-only)

### Proposed subpanels/tabs
1. **Overview** (default)
   - Allocation enabled toggle
   - Mode + strategy
   - Defaults (buffer minutes, max combine)
   - Advanced collapsible: overflow + emergency
2. **Zones**
   - Zone list + add/edit
   - Priority and tags
3. **Tables**
   - Table list + add/edit
   - Capacity + zone assignment
4. **Combinations**
   - Combos list + add/edit
   - Cross-zone rules (advanced)
5. **Floorplans**
   - Floorplan list + active selection
   - Background + layout editing

### Defaults / advanced
- **Default expanded:** Overview.
- **Default collapsed:** Advanced allocation details, debug tools.

---

# Decision Chain Block (Booking Details)

**Required fields (always visible):**
- Intent (preferred time slot, seating preference).
- Override (enabled?, zone/table selection).
- Final (source + locked state).
- Allocated (zone/table names).

**Diagnostics (collapsed):**
- reason/reasonCode, traceId, internal strategy string.

```
Intent
  timeSlot, preference
Override
  enabled, zone/tables
Final
  source, locked
Allocated
  zone/table names
Diagnostics ▼
  traceId, reason codes
```

---

# End-to-End Booking UI Structure (Target)

**At a glance summary (booking card)**
- Status badge + time + party size + name

**Booking details (modal/panel)**
1. Summary block
2. Capacity panel (limits + counts)
3. Allocation Decision Chain (diagnostics collapsed)
4. Seating + floorplan
5. Logs (collapsed)

